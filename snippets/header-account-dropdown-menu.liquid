{% comment %}
  {%- if shop.customer_accounts_enabled -%}
    <a
      href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
      class="header__icon header__icon--account link focus-inset{% if section.settings.menu != blank %} small-hide{% endif %}"
      rel="nofollow"
    >
      {%- if section.settings.enable_customer_avatar -%}
        <account-icon>
          {%- if customer and customer.has_avatar? -%}
            {{ customer | avatar }}
          {%- else -%}
            <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
          {%- endif -%}
        </account-icon>
      {%- else -%}
        <span class="svg-wrapper">{{ 'icon-account.svg' | inline_asset_content }}</span>
      {%- endif -%}
      <span class="visually-hidden">
        {%- liquid
          if customer
            echo 'customer.account_fallback' | t
          else
            echo 'customer.log_in' | t
          endif
        -%}
      </span>
    </a>
  {%- endif -%}
{% endcomment %}

{% comment %}
  {%- if shop.customer_accounts_enabled -%}
    <a
      href='{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}'
      class='twcss-flex twcss-items-center twcss-gap-x-1 twcss-text-secondary-light'
      rel='nofollow'
    >
      <span class='twcss-size-6 twcss-text-secondary-light'>{{ 'icon-account.svg' | inline_asset_content }}</span>
      <span class='twcss-font-semibold twcss-text-sm'> Frank </span>
    </a>
  {%- endif -%}
{% endcomment %}

<div class='twcss-relative'>
  <button
    class='twcss-flex twcss-items-center twcss-gap-x-2 twcss-text-secondary-light'
    data-account-button
  >
    <span class='twcss-size-6 twcss-text-secondary-light'>
      {{ 'icon-account.svg' | inline_asset_content }}
    </span>
    <span class='twcss-font-semibold twcss-text-sm'>
      {%- if customer -%}
        {{ customer.first_name }}
      {%- else -%}
        Frank
      {%- endif -%}
    </span>
    <span class='twcss-w-4 twcss-transition-transform twcss-duration-200' data-account-icon>
      {{ 'icon-caret.svg' | inline_asset_content }}
    </span>
  </button>

  <div
    class='twcss-absolute twcss-z-10 twcss-right-0 twcss-mt-2 twcss-w-48 twcss-bg-muted-default twcss-rounded-md twcss-shadow-lg twcss-hidden'
    data-account-dropdown
  >
    <div class='twcss-py-1 twcss-z-10'>
      {%- if customer -%}
        <a
          href='{{ routes.account_url }}'
          class='twcss-block twcss-px-4 twcss-py-2 twcss-text-sm twcss-text-accent-default hover:twcss-bg-gray-100'
        >
          My Account
        </a>
        <a
          href='{{ routes.account_orders_url }}'
          class='twcss-block twcss-px-4 twcss-py-2 twcss-text-sm twcss-text-accent-default hover:twcss-bg-gray-100'
        >
          Orders
        </a>
        <form method='post' action='{{ routes.account_logout_url }}'>
          <button
            type='submit'
            class='twcss-block twcss-w-full twcss-text-left twcss-px-4 twcss-py-2 twcss-text-sm twcss-text-accent-default hover:twcss-bg-gray-100'
          >
            Log out
          </button>
        </form>
      {%- else -%}
        <a
          href='{{ routes.account_login_url }}'
          class='twcss-block twcss-px-4 twcss-py-2 twcss-text-sm twcss-text-accent-default hover:twcss-bg-gray-100'
        >
          Log in
        </a>
        <a
          href='{{ routes.account_register_url }}'
          class='twcss-block twcss-px-4 twcss-py-2 twcss-text-sm twcss-text-accent-default hover:twcss-bg-gray-100'
        >
          Create account
        </a>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
  const accountButton = document.querySelector('[data-account-button]');
  const accountDropdown = document.querySelector('[data-account-dropdown]');
  const accountIcon = document.querySelector('[data-account-icon]');

  if (accountButton && accountDropdown) {
    accountButton.addEventListener('click', () => {
      accountDropdown.classList.toggle('twcss-hidden');
      accountIcon.style.transform = accountDropdown.classList.contains('twcss-hidden')
        ? 'rotate(0deg)'
        : 'rotate(180deg)';
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (!accountButton.contains(event.target) && !accountDropdown.contains(event.target)) {
        accountDropdown.classList.add('twcss-hidden');
        accountIcon.style.transform = 'rotate(0deg)';
      }
    });
  }
</script>
