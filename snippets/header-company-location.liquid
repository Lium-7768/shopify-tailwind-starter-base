<div class='twcss-relative'>
  <button class='twcss-flex twcss-items-center twcss-gap-x-2'>
    <span class='twcss-font-semibol twcss-hidden lg:twcss-flex'>
      {{ customer.current_location.name }}
    </span>
    {% if customer.company_available_locations.size > 1 %}
      <span
        class='twcss-w-4 twcss-transition-transform twcss-duration-200 twcss-rotate-180 twcss-hidden lg:twcss-flex'
        data-location-icon
      >
        {{ 'icon-caret.svg' | inline_asset_content }}
      </span>
    {% endif %}
  </button>

  {% if customer.company_available_locations.size > 1 %}
    <div
      class='twcss-absolute twcss-right-0 twcss-mt-2 twcss-bg-white twcss-rounded twcss-shadow-lg twcss-hidden twcss-w-96'
      data-location-dropdown
    >
      <div class='twcss-p-6 twcss-text-base twcss-space-y-4'>
        <div class='twcss-font-medium twcss-text-gray-700 twcss-text-center'>Choose your location</div>

        <div class='location-switcher twcss-space-y-2'>
          {% for location in customer.company_available_locations %}
            {% unless location.current? %}
              <div class='twcss-flex twcss-items-center twcss-p-3 twcss-rounded twcss-border twcss-border-gray-300 hover:twcss-bg-blue-50'>
                <input
                  type='radio'
                  id='location-{{ location.id }}'
                  name='location'
                  value='{{ location.id }}'
                  class='twcss-w-4 twcss-h-4 twcss-border twcss-border-gray-300 twcss-rounded-full twcss-text-blue-600 focus:twcss-ring-blue-500'
                  data-location-url='{{ location.url_to_set_as_current }}'
                  {% if location.current? %}
                    checked
                  {% endif %}
                >
                <label
                  for='location-{{ location.id }}'
                  class='twcss-ml-3 twcss-block twcss-text-sm twcss-font-medium twcss-text-gray-700'
                >
                  {{ location.name }}
                </label>
              </div>
            {% endunless %}
          {% endfor %}
        </div>

        <div class='twcss-flex twcss-gap-4 twcss-mt-6'>
          <button
            class='twcss-flex-1 twcss-py-3 twcss-px-4 twcss-border twcss-border-gray-300 twcss-rounded twcss-text-gray-700 hover:twcss-bg-gray-100'
            data-action='cancel'
          >
            Cancel
          </button>
          <a
            href='#'
            class='twcss-flex-1 twcss-py-3 twcss-px-4 twcss-bg-orange-500 twcss-text-white twcss-rounded hover:twcss-bg-orange-600 twcss-text-center'
            data-action='confirm'
          >
            Confirm
          </a>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const locationButton = document.querySelector('[data-location-icon]').parentElement;
        const locationDropdown = document.querySelector('[data-location-dropdown]');
        const locationIcon = document.querySelector('[data-location-icon]');
        const cancelButton = document.querySelector('[data-action="cancel"]');
        const confirmButton = document.querySelector('[data-action="confirm"]');

        function closeDropdown() {
          locationDropdown.classList.add('twcss-hidden');
          locationIcon.style.transform = 'rotate(180deg)';
        }

        if (locationButton && locationDropdown) {
          locationButton.addEventListener('click', () => {
            locationDropdown.classList.toggle('twcss-hidden');
            locationIcon.style.transform = locationDropdown.classList.contains('twcss-hidden')
              ? 'rotate(180deg)'
              : 'rotate(0deg)';
          });

          // Close dropdown when clicking outside
          document.addEventListener('click', (event) => {
            if (!locationButton.contains(event.target) && !locationDropdown.contains(event.target)) {
              closeDropdown();
            }
          });

          // Cancel button handler
          cancelButton.addEventListener('click', closeDropdown);

          // Confirm button handler
          confirmButton.addEventListener('click', (event) => {
            event.preventDefault();
            const selectedLocation = document.querySelector('input[name="location"]:checked');
            if (selectedLocation) {
              window.location.href = selectedLocation.dataset.locationUrl;
            }
          });
        }
      })();
    </script>
  {% endif %}
</div>
