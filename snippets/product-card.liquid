{% comment %}
  参数说明:
  - product: 产品对象
  - show_vendor: 是否显示供应商 (可选)
  - class: 额外的 CSS 类 (可选)
{% endcomment %}

<div class="{{ class | default: '' }} twcss-bg-white twcss-rounded-lg twcss-shadow-md twcss-h-[415px] twcss-w-full hover:twcss-shadow-lg twcss-transition-shadow twcss-duration-200 twcss-flex twcss-flex-col">
  <!-- 产品图片区域 -->
  <div class="twcss-h-[246px] twcss-w-full twcss-shadow-sm">
    <a href="{{ product.url }}" class="twcss-block twcss-w-full twcss-h-full">
      <img
        src="{{ product.featured_image | img_url: '246x246', crop: 'center' }}"
        alt="{{ product.title }}"
        class="twcss-object-contain twcss-w-full twcss-h-full"
        loading="lazy"
        width="246"
        height="246"
      >
    </a>
  </div>

  <!-- 产品信息区域 -->
  <div
    class="
      twcss-flex-1 twcss-flex twcss-flex-col twcss-bg-[#f8f8f8]
      twcss-p-4
    "
  >
    <div class="twcss-space-y-2 twcss-flex twcss-flex-col twcss-flex-1">
      <div class="twcss-text-gray-600">{{ product.vendor }}</div>

      <a
        href="{{ product.url }}"
        class="
          twcss-text-lg twcss-font-bold
          twcss-line-clamp-2
        "
      >
        {{ product.title }}
      </a>

      <div class="twcss-space-y-1 twcss-text-sm">
        <p class="twcss-text-gray-600">Customer Product # {{ product.id }}</p>
        <p class="twcss-text-gray-600">
          Supplier Product # {{ product.metafields.custom.supplier_id | default: 'R9013DS' }}
        </p>
        <p class="twcss-text-gray-600">Supplier: {{ product.vendor }}</p>
      </div>
    </div>

    <!-- 添加到购物车按钮 -->

    <div
      class="
        twcss-flex twcss-items-center twcss-justify-center
        twcss-relative twcss-w-full
      "
    >
      <form
        action="/cart/add"
        method="post"
        onclick="event.stopPropagation()"
        class="twcss-flex-1"
        data-ajax-cart-form
      >
        <input
          type="hidden"
          name="id"
          value="{{ product.variants.first.id }}"
        >
        <input type="hidden" name="quantity" value="1">
        <button
          type="submit"
          class="
            twcss-bg-orange-500 twcss-flex twcss-items-center
            twcss-justify-center hover:twcss-bg-orange-600 twcss-text-white
            twcss-px-4 twcss-py-2 twcss-rounded twcss-w-full twcss-font-bold
            twcss-relative
          "
        >
          Add to Cart
        </button>
      </form>
      <div
        class="
          twcss-absolute twcss-right-0 twcss-top-0 twcss-w-[36px]
          twcss-h-full twcss-flex twcss-items-center twcss-justify-center
          twcss-border-l-[0.5px] twcss-border-white twcss-bg-orange-500
          hover:twcss-bg-orange-600 twcss-text-white twcss-px-4 twcss-py-2
          twcss-rounded
        "
      >
        {% render 'icon-chevron-down' %}
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('[data-ajax-cart-form]').forEach((form) => {
      form.addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(form);

        fetch('/cart/add.js', {
          method: 'POST',
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            // 可以在这里添加成功提示
            console.log('Added to cart:', data);
          })
          .catch((error) => {
            console.error('Error:', error);
          });
      });
    });
  });
</script>
