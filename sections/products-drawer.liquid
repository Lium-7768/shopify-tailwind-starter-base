{%- style -%}
  .twcss-animate-slide-in {
    animation: slideIn 300ms ease-out forwards;
  }

  .twcss-animate-slide-out {
    animation: slideOut 300ms ease-in forwards;
  }

  @keyframes slideIn {
    from {
      transform: translateX(100%);
    }
    to {
      transform: translateX(0);
    }
  }

  @keyframes slideOut {
    from {
      transform: translateX(0);
    }
    to {
      transform: translateX(100%);
    }
  }
{%- endstyle -%}

<products-drawer>
  <div id="products-drawer" class="twcss-fixed twcss-inset-0 twcss-z-50 twcss-overflow-hidden" aria-labelledby="slide-over-title" role="dialog" aria-modal="true" style="display: none;">
    <div class="twcss-absolute twcss-inset-0 twcss-overflow-hidden">
      <!-- Overlay -->
      <div class="twcss-absolute twcss-inset-0 twcss-bg-black/50 twcss-transition-opacity" aria-hidden="true"></div>
      
      <div class="twcss-pointer-events-none twcss-fixed twcss-inset-y-0 twcss-right-0 twcss-flex twcss-max-w-full">
        <div class="twcss-pointer-events-auto twcss-w-screen twcss-max-w-md">
          <div class="twcss-flex twcss-h-full twcss-flex-col twcss-overflow-y-scroll twcss-bg-white">
            <!-- Header -->
            <div class="twcss-flex twcss-items-center twcss-justify-between twcss-px-6 twcss-py-4 twcss-border-b twcss-border-gray-200">
              <div class="twcss-flex twcss-items-center">
                {%- if settings.logo != blank -%}
                  {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
                  {%- assign logo_height = 32 -%}
                  {%- assign logo_width = logo_height | times: settings.logo.aspect_ratio | round -%}
                  {{ settings.logo | image_url: width: logo_width | image_tag:
                    class: 'twcss-h-8 twcss-w-auto',
                    widths: logo_width,
                    height: logo_height,
                    width: logo_width,
                    alt: logo_alt,
                    loading: 'lazy'
                  }}
                {%- else -%}
                  <span class="twcss-text-lg twcss-font-semibold twcss-text-gray-900">{{ shop.name }}</span>
                {%- endif -%}
              </div>
              <button type="button" class="products-drawer-close twcss-text-gray-400 hover:twcss-text-gray-500">
                <span class="twcss-sr-only">Close panel</span>
                <svg class="twcss-h-6 twcss-w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              </button>
            </div>

            <!-- Categories -->
            <div class="twcss-flex-1 twcss-overflow-y-auto">
              <!-- Operational Products -->
              <div class="twcss-py-4">
                <h3 class="twcss-px-6 twcss-text-lg twcss-font-semibold twcss-text-primary-default">Operational Products</h3>
                <div class="twcss-mt-2">
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Office supplies</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Industrial safety equipment</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Tools and machinery</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Packaging materials</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Furniture and storage</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                </div>
              </div>

              <!-- Logistics Services -->
              <div class="twcss-py-4 twcss-border-t twcss-border-gray-200">
                <h3 class="twcss-px-6 twcss-text-lg twcss-font-semibold twcss-text-primary-default">Logistics Services</h3>
                <div class="twcss-mt-2">
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Transportation and distribution</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Inventory management</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Warehousing and storage</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">International shipping</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Tracking and monitoring</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                </div>
              </div>

              <!-- Technology and Digital Solutions -->
              <div class="twcss-py-4 twcss-border-t twcss-border-gray-200">
                <h3 class="twcss-px-6 twcss-text-lg twcss-font-semibold twcss-text-primary-default">Technology and Digital Solutions</h3>
                <div class="twcss-mt-2">
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Enterprise management software (ERP)</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">E-commerce solutions</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Tracking and optimization systems</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">IT infrastructure</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                  <a href="#" class="twcss-block twcss-px-6 twcss-py-3 hover:twcss-bg-gray-50">
                    <div class="twcss-flex twcss-items-center twcss-justify-between">
                      <span class="twcss-text-gray-700">Business communication devices</span>
                      <svg class="twcss-h-5 twcss-w-5 twcss-text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                      </svg>
                    </div>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</products-drawer>

<script>
  class ProductsDrawer extends HTMLElement {
    constructor() {
      super();
      this.drawer = this.querySelector('#products-drawer');
      this.closeButtons = this.querySelectorAll('.products-drawer-close');
      // 延迟绑定事件，确保所有元素都已加载
      window.addEventListener('DOMContentLoaded', () => this.bindEvents());
    }

    bindEvents() {
      const trigger = document.getElementById('products-drawer-trigger');
      console.log('Trigger element:', trigger); // Debug log
      
      if (trigger) {
        console.log('Adding click listener to trigger'); // Debug log
        trigger.addEventListener('click', () => {
          console.log('Trigger clicked'); // Debug log
          this.open();
        });
      }

      this.closeButtons.forEach(button => {
        button.addEventListener('click', () => this.close());
      });

      // Close drawer when clicking overlay
      this.drawer.addEventListener('click', (e) => {
        if (e.target === this.drawer) {
          this.close();
        }
      });

      // Close drawer on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && this.drawer.style.display === 'block') {
          this.close();
        }
      });
    }

    open() {
      console.log('Opening drawer');  // Debug log
      this.drawer.style.display = 'block';
      document.body.style.overflow = 'hidden';
      
      requestAnimationFrame(() => {
        const drawer = this.drawer.querySelector('.twcss-max-w-md');
        drawer.classList.add('twcss-animate-slide-in');
      });
    }

    close() {
      console.log('Closing drawer');  // Debug log
      const drawer = this.drawer.querySelector('.twcss-max-w-md');
      drawer.classList.add('twcss-animate-slide-out');
      
      setTimeout(() => {
        this.drawer.style.display = 'none';
        document.body.style.overflow = '';
        drawer.classList.remove('twcss-animate-slide-out', 'twcss-animate-slide-in');
      }, 300);
    }
  }

  // 确保在 DOM 完全加载后再定义自定义元素
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      customElements.define('products-drawer', ProductsDrawer);
    });
  } else {
    customElements.define('products-drawer', ProductsDrawer);
  }
</script>

{% schema %}
{
  "name": "Products Drawer",
  "settings": [
    {
      "type": "text",
      "id": "drawer_title",
      "label": "Drawer Title",
      "default": "Operational Products"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        {
          "type": "text",
          "id": "category_title",
          "label": "Category Title",
          "default": "Category"
        },
        {
          "type": "url",
          "id": "category_link",
          "label": "Category Link"
        }
      ]
    }
  ]
}
{% endschema %}